---
title: 安卓自定义控件
date: 2017-07-17 10:19:39
tags: [安卓,自定义控件]
categories: [安卓学习]
---

### 自定义UI组件
  许久没有更新自己的博客了，感觉这些天，并没有做什么额。想想接下来这些时间还是多学习学习安卓的基础，多花时间尝试做一些小Demo。
  昨天，跟着网易云课堂自己做了一个自定义UI控件的小例子，分为以下三个步骤：
  1.设计需要的属性：
     新建一个attrs.xml文件声明以下内容 <!--more-->
  ```
  <?xml version="1.0" encoding="utf-8"?>
<resources>
    <declare-styleable name="Topbar">
        <!--自定义属性-->
        <!--中间的标题-->
        <attr name="title" format="string" />
        <attr name="titleTextSize" format="dimension" />
        <attr name="titleTextColor" format="color" />
        <!--左边的按钮-->
        <attr name="leftTextColor" format="color"/>
        <attr name="leftTextSize" format="dimension"/>
        <attr name="leftText" format="string"/>
        <attr name="leftBackground" format="color|reference"/>
        <!--右边的按钮-->
        <attr name="rightTextColor" format="color"/>
        <attr name="rightTextSize" format="dimension"/>
        <attr name="rightText" format="string"/>
        <attr name="rightBackground" format="color|reference"/>
    </declare-styleable>
    <!--"reference" //引用-->
    <!--"color" //颜色-->
    <!--"boolean" //布尔值-->
    <!--"dimension" //尺寸值-->
    <!--"float" //浮点值-->
    <!--"integer" //整型值-->
    <!--"string" //字符串-->
    <!--"fraction" //百分数,比如20%-->
</resources>
  ```
  
  2.实现一个我们的自定义View

```
package com.example.topbardemo;

import android.content.Context;
import android.content.res.TypedArray;
import android.graphics.Color;
import android.graphics.drawable.Drawable;
import android.support.annotation.Dimension;
import android.util.AttributeSet;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.RelativeLayout;
import android.widget.TextView;

public class Topbar extends RelativeLayout{

    //自定义控件中的组件
    private Button leftButton,rightButton;
    private TextView tvTitle;

    //各组件的属性
    private String title;
    private float titleTextSize;
    private int titleTextColor;

    private int leftButtonColor;
    private String leftText;
    private Drawable leftBack;
    private float leftTextSize;

    private int rightButtonColor;
    private String rightText;
    private Drawable rightBack;
    private float rightTextSize;

    private LayoutParams leftParam,rightParam,titleParam;

    private topbarClickListener listener;

    public interface topbarClickListener{
        void leftClick();
        void rightClick();
    }

    //接口回调机制，实现组件的事件
    public void setTopbarClickListener(topbarClickListener listener){
        this.listener=listener;
    }

    public Topbar(Context context, AttributeSet attrs) {
        super(context, attrs);                                     //引用自定义的属性name
        TypedArray typedArray = context.obtainStyledAttributes(attrs,R.styleable.Topbar);

        //获取到自定义的各个属性
        title=typedArray.getString(R.styleable.Topbar_title);
        titleTextColor=typedArray.getColor(R.styleable.Topbar_titleTextColor,0);
        titleTextSize=typedArray.getDimension(R.styleable.Topbar_titleTextSize,1);

        leftText = typedArray.getString(R.styleable.Topbar_leftText);
        leftButtonColor = typedArray.getColor(R.styleable.Topbar_leftTextColor,0);
        leftTextSize = typedArray.getDimension(R.styleable.Topbar_leftTextSize,1);
        leftBack = typedArray.getDrawable(R.styleable.Topbar_leftBackground);

        rightText = typedArray.getString(R.styleable.Topbar_rightText);
        rightButtonColor = typedArray.getColor(R.styleable.Topbar_rightTextColor,0);
        rightTextSize = typedArray.getDimension(R.styleable.Topbar_rightTextSize,1);
        rightBack = typedArray.getDrawable(R.styleable.Topbar_rightBackground);

        //调用结束后务必调用recycle()方法，否则这次的设定会对下次的使用造成影响
        typedArray.recycle();

        //定义各个组件
        leftButton= new Button(context);
        rightButton = new Button(context);
        tvTitle =new TextView(context);

        //为组件添加属性
        leftButton.setText(leftText);
        leftButton.setTextColor(leftButtonColor);
        leftButton.setTextSize(leftTextSize);
        leftButton.setBackground(leftBack);

        rightButton.setText(rightText);
        rightButton.setTextColor(rightButtonColor);
        rightButton.setTextSize(rightTextSize);
        rightButton.setBackground(rightBack);

        tvTitle.setText(title);
        tvTitle.setTextColor(titleTextColor);
        tvTitle.setTextSize(titleTextSize);

        setBackgroundColor(0xFFF1233);

        //布局参数样式
        leftParam = new LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT);
        leftParam.addRule(RelativeLayout.ALIGN_PARENT_LEFT,TRUE);

        //组件以leftParam样式添加到View中
        addView(leftButton,leftParam);

        rightParam = new LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT);
        rightParam.addRule(RelativeLayout.ALIGN_PARENT_RIGHT,TRUE);

        addView(rightButton,rightParam);

        titleParam = new LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT);
        titleParam.addRule(RelativeLayout.CENTER_IN_PARENT,TRUE);

        addView(tvTitle,titleParam);

        //组件的点击事件
        leftButton.setOnClickListener(new OnClickListener() {
            @Override
            public void onClick(View view) {
                listener.leftClick();
            }
        });

        rightButton.setOnClickListener(new OnClickListener() {
            @Override
            public void onClick(View view) {
                listener.rightClick();
            }
        });

    }

    //其他事件的完善
    public void setLeftButtonVisable(boolean flag){
        if (flag){
            leftButton.setVisibility(VISIBLE);
        }else {
            leftButton.setVisibility(GONE);
        }
    }
}
```

  3.引用我们的View

 - 在activity_main.xml中引入` xmlns:custom="http://schemas.android.com/apk/res-auto" `声明引用的组件并设置属性值

```
	<com.example.topbardemo.Topbar
            android:id="@+id/topbar"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            custom:leftText="Left"
            custom:leftTextColor="@color/colorPrimaryDark"
            custom:leftTextSize="8sp"
            custom:rightText="Right"
            custom:rightTextColor="@color/colorPrimaryDark"
            custom:rightTextSize="8sp"
            custom:title="自定义标题"
            custom:titleTextColor="@color/colorAccent"
            custom:titleTextSize="10sp"
            >
    </com.example.topbardemo.Topbar>

```

- 在Activity中定义各个组件的事件。
  ```
  topbar= (Topbar) findViewById(R.id.topbar);
        topbar.setTopbarClickListener(new Topbar.topbarClickListener() {
            @Override
            public void leftClick() {
                Toast.makeText(getApplicationContext(),"Left",Toast.LENGTH_SHORT).show();
            }

            @Override
            public void rightClick() {
                Toast.makeText(getApplicationContext(),"Right",Toast.LENGTH_SHORT).show();
            }
        });

        button = (Button) findViewById(R.id.button1);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                topbar.setLeftButtonVisable(false);
            }
        });
  ```
  
  最后的完成的效果：
<center>
  
 <img src="http://hexoblog-1253306922.cosgz.myqcloud.com/photo2017/andriod%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6.jpg" width="150" height="150" />
 
 </center>